extends layout

block content
    div
        span.h1.me-2 Mes processus
        span.h4 #{jobs.length}

    .row
        .col-4
            each state in ['created', 'in progress', 'completed', 'error']
                div #{state} : #{jobs.filter(j => j.state === state).length}
        .col-4
            each type in ['complete', 'reload-complete', 'completeEach']
                div #{type} : #{jobs.filter(j => j.type === type).length}
        .col-4
            div
                a(href="/jobs/reload").btn.btn-light Complete : relancer les dernières erreurs
            div
                a(href="/jobs/clean").btn.btn-light * : Effacer les processus terminés & en erreur
            div
                a(href="/jobs/force-error").btn.btn-light * : Marquer les processus non terminé en erreur

    .accordion#accordion.accordion-flush
        each job in jobs
            .accordion-item
                h2.accordion-header(id=`${job.id}`)
                    button(type="button" data-bs-toggle="collapse" data-bs-target=`#collapse${job.id}` aria-expanded="true" aria-controls=`#collapse${job.id}`).accordion-button.collapsed
                        | #{job.id} #{job.type} : #{job.state} - #{job.creationDate.toISOString()}
                .accordion-collapse.collapse(id=`collapse${job.id}` data-bs-parent="#accordion")
                    .accordion-body
                        div
                            span à jour le #{job.updatedOn.toISOString()}
                        div #{JSON.stringify(job.details, null, 2)}

